---
import '../styles/global.css';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import StickySocialCTA from '../components/ui/StickySocialCTA.astro';
import { site } from '../content/site';

type Props = {
  title: string;
  description?: string;
  ogImage?: string;
};

const { title, description, ogImage = '/media/index-4.jpg' } = Astro.props;
const canonical = Astro.url;

const commonOrg = {
  '@context': 'https://schema.org',
  name: site.name,
  url: canonical.toString(),
  telephone: site.phones,
  email: site.email,
  address: site.addressLine,
  sameAs: [site.facebookUrl],
};

const schema = [
  { '@type': 'Restaurant', ...commonOrg },
  { '@type': 'LodgingBusiness', ...commonOrg },
];
---

<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>{title}</title>
    {description ? <meta name="description" content={description} /> : null}
    <link rel="canonical" href={canonical.toString()} />
    <meta name="theme-color" content="#1f3025" />

    <meta property="og:site_name" content={site.name} />
    <meta property="og:title" content={title} />
    {description ? <meta property="og:description" content={description} /> : null}
    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonical.toString()} />
    <meta property="og:image" content={ogImage} />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={title} />
    {description ? <meta name="twitter:description" content={description} /> : null}
    <meta name="twitter:image" content={ogImage} />

    <script type="application/ld+json" set:html={JSON.stringify(schema)} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" href="/favicon.ico" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous" />
    <link
      href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@500;600;700&family=Manrope:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
  </head>
  <body>
    <a href="#main" class="skip-link">Saltar al contenido</a>
    <Header />
    <main id="main">
      <slot />
    </main>
    <Footer />
    <StickySocialCTA />
    <script is:inline>
      (() => {
        const targets = [...document.querySelectorAll('.animate-rise')];
        if (targets.length === 0) return;

        const reduceMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        if (reduceMotion || !('IntersectionObserver' in window)) {
          targets.forEach((node) => node.classList.add('in-view'));
          return;
        }

        const viewport = window.innerHeight || 0;
        const deferred = [];
        const observer = new IntersectionObserver(
          (entries, obs) => {
            entries.forEach((entry) => {
              if (!entry.isIntersecting) return;
              entry.target.classList.add('in-view');
              obs.unobserve(entry.target);
            });
          },
          { threshold: 0.12, rootMargin: '0px 0px -8% 0px' },
        );

        targets.forEach((node, index) => {
          if (!(node instanceof HTMLElement)) return;
          node.style.setProperty('--reveal-delay', `${(index % 4) * 45}ms`);

          const rect = node.getBoundingClientRect();
          if (rect.top < viewport * 0.9) {
            node.classList.add('in-view');
            return;
          }
          deferred.push(node);
        });

        document.body.classList.add('motion-ready');
        deferred.forEach((node) => observer.observe(node));
      })();
    </script>
  </body>
</html>
